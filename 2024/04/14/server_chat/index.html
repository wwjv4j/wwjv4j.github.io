<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;gradio&quot;&gt;&lt;a href=&quot;#gradio&quot; class=&quot;headerlink&quot; title=&quot;gradio&quot;&gt;&lt;/a&gt;gradio&lt;/h2&gt;&lt;h4 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h4&gt;&lt;p&gt;在人工智能飞速发展的今天，向世界展示你的ai模型变得越来越重要，这就是gradio发挥作用的地方：一个简单且直观的工具，让初学者也能够快速展示部署的模型。&lt;br&gt;gradio是一个开源的python库，用于快速创建一个简单交互界面。通常运用于聊天机器人，机器学习模型等领域。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>使用gradio和openai api快速部署gpt聊天网页 | Welcome to Wwj's blog</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 7.1.1"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-time">2024-04-14</div></div></div><div class="container post-header"><h1>使用gradio和openai api快速部署gpt聊天网页</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#gradio"><span class="toc-number">1.</span> <span class="toc-text">gradio</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.0.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.0.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">1. 核心组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%AE%9E%E4%BE%8B-%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">2. 实例-创建简单聊天机器人</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%B8%80%E4%BA%9BChatInterface%E6%9E%84%E5%BB%BA%E6%97%B6%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.0.2.3.</span> <span class="toc-text">3. 一些ChatInterface构建时常用的参数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openai-api"><span class="toc-number">2.</span> <span class="toc-text">openai api</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gpt%E8%81%8A%E5%A4%A9%E7%BD%91%E9%A1%B5"><span class="toc-number">3.</span> <span class="toc-text">gpt聊天网页</span></a></li></ol></details></div><div class="container post-content"><h2 id="gradio"><a href="#gradio" class="headerlink" title="gradio"></a>gradio</h2><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>在人工智能飞速发展的今天，向世界展示你的ai模型变得越来越重要，这就是gradio发挥作用的地方：一个简单且直观的工具，让初学者也能够快速展示部署的模型。<br>gradio是一个开源的python库，用于快速创建一个简单交互界面。通常运用于聊天机器人，机器学习模型等领域。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="1-核心组件"><a href="#1-核心组件" class="headerlink" title="1. 核心组件"></a>1. 核心组件</h5><ul>
<li><strong>Interface</strong> Interface类是gradio的核心类，他允许用户定义输入和输出类型，，创建交互式的Web界面。</li>
<li><strong>输入</strong> gradio支持多种类型的输入，如文本，图片，甚至是音频。</li>
<li><strong>输出</strong> gradio支持的输出类型和输入对应，也包括文本，图片，音频。</li>
</ul>
<h5 id="2-实例-创建简单聊天机器人"><a href="#2-实例-创建简单聊天机器人" class="headerlink" title="2. 实例-创建简单聊天机器人"></a>2. 实例-创建简单聊天机器人</h5><p>python要求版本不小于3。8，通过<code>pip install gradio</code>命令安装。</p>
<p>gradio里专门提供了创建聊天机器人的类<code>ChatInterface</code>，通过提供response函数和一些样式设计参数，快速搭建一个聊天机器人。之后通过调用gradio的launch函数，就能够在本地<del>默认是7860端口</del>进行访问。</p>
<p>下面实现一个只会输出<code>hello world！</code>的傻瓜式机器人：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr <span class="comment"># 导入gradio包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">response</span>(<span class="params">message, history</span>): <span class="comment"># 实现输出的函数，必须接受两个参数，一个输入消息，一个历史聊天记录</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world!&quot;</span></span><br><span class="line"></span><br><span class="line">chat = gr.ChatInterface( <span class="comment">#创建聊天实例</span></span><br><span class="line">    fn = response, <span class="comment"># 第一个参数为输出函数，后面可以跟一些样式的设计，文章后面会有介绍</span></span><br><span class="line">)</span><br><span class="line">chat.launch() <span class="comment"># 在本地搭建，默认是7860号端口</span></span><br></pre></td></tr></table></figure>
<p>当然，有了输出函数的定义，我们的思路就很简单了：<del>根据输入和历史对话生成输出</del> 。</p>
<p>这只是最简单的一个文本聊天界面，可以通过参数来实现更复杂的界面和输入，也可以把模型放到输出函数以实现更优秀的输出。</p>
<h5 id="3-一些ChatInterface构建时常用的参数"><a href="#3-一些ChatInterface构建时常用的参数" class="headerlink" title="3. 一些ChatInterface构建时常用的参数"></a>3. 一些ChatInterface构建时常用的参数</h5><ul>
<li><strong>fn(必需的)</strong><br>输出函数，如果是ChatInterface类，则必须接受两个参数：字符串输入消息和表示历史聊天记录的[user_message,bot_message]形式的双元素列表列表，并返回字符串响应。</li>
<li><strong>multiimodal</strong><br>默认值： False<br>如果为True，聊天界面将使用gr.MultimodalTextbox组件进行输入，允许上传多媒体文件。</li>
<li><strong>textbox</strong><br>默认值： None<br>如果项自定义文本框属性，则为聊天界面使用gr.Textbox或gr.MultimodalTextbox组件的实例。</li>
<li><strong>examples</strong><br>默认值： None<br>如果提供，则会将提供的内容放在聊天机器人聊天框的下方，可以单击以填充聊天机器人。</li>
<li><strong>title</strong><br>默认值： None<br>界面的标题，以大字体显示在聊天机器人山房，也用作选项卡标题。</li>
<li><strong>theme</strong><br>默认值： None<br>要使用的主题，需要从gradio.themes加载。</li>
</ul>
<h2 id="openai-api"><a href="#openai-api" class="headerlink" title="openai api"></a>openai api</h2><p>openai api的获取和使用可以参考这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/Lvbaby_/article/details/131741328">博客</a>和<a target="_blank" rel="noopener" href="https://github.com/openai/openai-cookbook">官方文档</a>。</p>
<h2 id="gpt聊天网页"><a href="#gpt聊天网页" class="headerlink" title="gpt聊天网页"></a>gpt聊天网页</h2><p>有了gradio和openai api后就可以部署一个简单的gpt聊天界面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="comment"># from dotenv import load_dotenv</span></span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">client = OpenAI(</span><br><span class="line">    max_retries = <span class="number">1</span>, <span class="comment">#最多尝试次数</span></span><br><span class="line">    timeout =  <span class="number">60</span>, <span class="comment">#最长等待时间</span></span><br><span class="line">    api_key=<span class="string">&quot;Your Openai API Key&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">response</span>(<span class="params">message, history</span>):</span><br><span class="line">    chat = client.chat.completions.create(</span><br><span class="line">        model = <span class="string">&quot;gpt-3.5-turbo&quot;</span>,  <span class="comment">#模型使用gpt-3.5</span></span><br><span class="line">        messages = [</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a chatbot. You can help people with their questions about anything.&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: message&#125;,</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    response = chat.choices[<span class="number">0</span>].message.content</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(response)): <span class="comment">#流式回答</span></span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">        <span class="keyword">yield</span> response[: i+<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chat = gr.ChatInterface(</span><br><span class="line">    response,</span><br><span class="line">    textbox = gr.Textbox(placeholder = <span class="string">&quot;Ask me any question about my blog or others&quot;</span>, container = <span class="literal">False</span>, scale = <span class="number">10</span>),</span><br><span class="line">    title = <span class="string">&quot;Blog Chat&quot;</span>,</span><br><span class="line">    description = <span class="string">&quot;Ask me any question about my blog or others&quot;</span>,</span><br><span class="line">    undo_btn = <span class="literal">None</span>,</span><br><span class="line">    examples=[<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;Am I cool?&quot;</span>, <span class="string">&quot;Are tomatoes vegetables?&quot;</span>],</span><br><span class="line">    cache_examples=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">chat.launch()</span><br></pre></td></tr></table></figure>

<p>更多语法和更复杂的用法还在学习中ing。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>